# [`trip_builder.py`](../../src/logic/trip_builder.md)

This module defines the core data structures and logic for handling flight trip data, including:

- `Trip`: represents a one-way flight.
- `RoundTrip`: encapsulates a pair of outbound and return `Trip`s.
- `RoundTripOptions`: groups multiple round trips between a city pair, providing summary and presentation functionality.

---

## 📦 Classes

### `Trip`

Represents a one-way flight option.

#### Attributes:
- `availability_Id`: Availability ID from the source.
- `origin_airport`, `destination_airport`: IATA airport codes.
- `departure`, `arrival`: ISO-formatted date strings.
- `booking_links`: Concatenated string of booking URLs.
- `source`: Provider/source of the fare (e.g., "azul", "smiles").
- `mileage_cost`: Award miles required.
- `taxes`, `taxes_currency`, `taxes_currency_symbol`: Taxes and metadata.
- `cabin`: Cabin class code (e.g., "Y", "W").
- `total_cost`, `selling_price`: Cost calculation including commission and fees.
- `normal_total_cost`, `normal_selling_price`: Amounts converted into the system's base currency.

#### Methods:
- `*_to_str()`: Human-readable currency strings for display/export.

---

### `RoundTrip`

Encapsulates an outbound and return `Trip`.

#### Attributes:
- `outbound`, `return_`: Two `Trip` instances.
- `selling_price`, `normal_selling_price`: Combined totals.

#### Methods:
- `make_row()`: Outputs a flat list of data fields for spreadsheets.
- `normal_selling_price_to_str()`: Converts total price to readable string.

---

### `RoundTripOptions`

Represents a collection of `RoundTrip`s between the same origin and destination, bundled with UI and presentation elements.

#### Attributes:
- `roundTrips`: A list of `RoundTrip` objects.
- `origin_city`, `destination_city`: Human-readable names.
- `origin_country`, `destination_country`: ISO country codes.
- `departure_dates`, `return_dates`: Sorted date sets.
- `selling_price`: Highest individual round trip price.
- `cabin`, `source`: Fare metadata.
- `release_date`: Date of release/visibility.
- `whatsapp_post`: Autogenerated post using OpenAI.
- `images`: List of image URLs fetched via Unsplash.

---

## 🔁 Utility Functions

### `getHighestSellingPrice(trips: list[RoundTrip]) -> str`

Returns the highest selling price from a list of round trips as a formatted string.

---

### `format_availability_object(availabilityObject: dict) -> Trip`

Creates a `Trip` object from the availability payload retrieved from APIs.

---

## 🔗 Dependencies

- [`config`](../config.md): Configuration constants and parameters.
- [`global_state`](../global_state.md): Logging system.
- [`currencies.mileage`](../currencies/mileage.md): Provides mileage valuation.
- [`currencies.cash`](../currencies/cash.md): Currency normalization utilities.
- [`openAI`](../services/openAI.md): For content generation
- [`unsplash`](../services/unsplash.md): For fetching images
